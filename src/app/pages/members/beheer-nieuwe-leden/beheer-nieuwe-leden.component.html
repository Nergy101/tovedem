<div class="container mt-4">
  <div class="container">
    <div class="row">
      <p class="display-1">Leden Aanmeldingen</p>
    </div>

    <div class="row pt-4">
      @defer (when leden()) {
      <div class="row" style="margin-top: 1em">
        <mat-form-field class="col-12" appearance="outline">
          <mat-label>Zoek op voornaam, achternaam of email</mat-label>
          <input
            matInput
            type="text"
            [ngModel]="searchTerm()"
            (ngModelChange)="onSearchTermChanged($event)"
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        @if (searching()) {
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        }
      </div>

      <mat-card class="table-responsive table-width">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Email</th>
              <th scope="col">Bericht</th>
              <th scope="col">Status</th>
              <th scope="col">Aangemaakt</th>
              @if (!!authService.isGlobalAdmin) {
              <th></th>
              }
            </tr>
          </thead>
          <tbody>
            @for (lid of leden(); track lid.id) {
            <tr>
              <td>{{ lid.email }}</td>
              <td>
                @if (lid.bericht && lid.bericht.length > 0) {
                <button
                  mat-button
                  class="bericht-button"
                  (click)="openBerichtDialog(lid)"
                  [matTooltip]="'Klik om volledig bericht te bekijken'"
                >
                  <mat-icon [style.color]="'#000'"
                    >chat_bubble_outline</mat-icon
                  >
                  <span>Bekijken</span>
                </button>
                } @else {
                <span>-</span>
                }
              </td>
              <td>
                <mat-form-field appearance="outline" class="status-select">
                  <mat-select
                    [value]="lid.status || 'nieuw'"
                    (selectionChange)="updateStatus(lid, $event.value)"
                  >
                    <mat-option value="nieuw">Nieuw</mat-option>
                    <mat-option value="geverifieerd">Geverifieerd</mat-option>
                    <mat-option value="gekoppeld">Gekoppeld</mat-option>
                  </mat-select>
                </mat-form-field>
              </td>
              <td>{{ formatDate(lid.created) }}</td>

              @if (!!authService.isGlobalAdmin) {
              <td>
                <button
                  mat-icon-button
                  (click)="delete(lid.id)"
                  [disabled]="loading()"
                >
                  <mat-icon color="warn">delete</mat-icon>
                </button>
              </td>
              }
            </tr>
            } @empty {
            <tr>
              <td
                [attr.colspan]="authService.isGlobalAdmin ? 5 : 4"
                style="text-align: center; padding: 2em"
              >
                Geen aanmeldingen gevonden
              </td>
            </tr>
            }
          </tbody>
        </table>
      </mat-card>
      } @placeholder {
      <div class="center">
        <mat-spinner></mat-spinner>
      </div>
      }
    </div>
  </div>
</div>
